---
import Container from "@/components/layout/Container.astro";
import { Button } from "@/components/ui/button";
---

<Container>
  <div class="flex flex-col items-center gap-10 mx-auto max-w-4xl mt-16">
    <div class="max-w-2xl w-full">
      <form
        name="contact"
        method="POST"
        id="form"
        class="needs-validation"
        novalidate
        data-netlify="true"
        netlify-honeypot="bot-field"
      >
        <input type="hidden" name="form-name" value="contact" />
        <p class="hidden">
          <label>
            Don’t fill this out if you’re human: <input name="bot-field" />
          </label>
        </p>
        <div class="mb-5">
          <input
            type="text"
            placeholder="Full Name"
            required
            class="w-full px-4 py-3 placeholder:text-muted-foreground rounded-md outline-hidden border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 focus:ring-4"
            name="name"
          />
          <div class="empty-feedback invalid-feedback text-red-400 text-sm mt-1">Please provide your full name.</div>
        </div>
        <div class="mb-5">
          <label for="email_address" class="sr-only">Email Address</label><input
            id="email_address"
            type="email"
            placeholder="Email Address"
            name="email"
            required
            class="w-full px-4 py-3 placeholder:text-muted-foreground rounded-md outline-hidden border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 focus:ring-4"
          />
          <div class="empty-feedback text-red-400 text-sm mt-1">Please provide your email address.</div>
          <div class="invalid-feedback text-red-400 text-sm mt-1">Please provide a valid email address.</div>
        </div>
        <div class="mb-3">
          <textarea
            name="message"
            required
            placeholder="Your Message"
            class="w-full px-4 py-3 placeholder:text-muted-foreground rounded-md outline-hidden border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 focus:ring-4 h-36"
          ></textarea>
          <div class="empty-feedback invalid-feedback text-red-400 text-sm mt-1">Please enter your message.</div>
        </div>
        <Button
          type="submit"
          variant="outline"
          size="lg"
          className="rounded-full text-base shadow-none hover:cursor-pointer"
        >
          Send Message
        </Button>
        <div id="result" class="mt-3 text-center"></div>
      </form>
    </div>
  </div>
</Container>

<style>
  .invalid-feedback,
  .empty-feedback {
    display: none;
  }

  .was-validated :placeholder-shown:invalid ~ .empty-feedback {
    display: block;
  }

  .was-validated :not(:placeholder-shown):invalid ~ .invalid-feedback {
    display: block;
  }

  .is-invalid,
  .was-validated :invalid {
    border-color: #dc3545;
  }
</style>

<script is:inline define:vars={{ pathName: Astro.originPathname }}>
  const form = document.getElementById("form");
  const result = document.getElementById("result");

  form.addEventListener("submit", function (e) {
    e.preventDefault();
    form.classList.add("was-validated");
    if (!form.checkValidity()) {
      form.querySelectorAll(":invalid")[0].focus();
      return;
    }
    const formData = new FormData(form);

    result.innerHTML = "Sending...";

    fetch(pathName, {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: new URLSearchParams(formData).toString(),
    })
      .then(() => {
        result.classList.add("text-green-500");
        result.innerText = "Form Submitted Successfully";

        form.reset();
        form.classList.remove("was-validated");
        setTimeout(() => {
          result.style.display = "none";
        }, 5000);
      })
      .catch((error) => {
        console.log(error);
        result.classList.add("text-red-500");
        result.innerHTML = "Something went wrong!";
      });
  });
</script>
